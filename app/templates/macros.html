{# Macros #}

{# File Card #}
{% macro file_card(file, hls=0, hle=0, custom_body=None) %}
<div
    class="file-card
    {% if file.is_locked %} locked {% endif %}
    {% if file.visibility == FileVisibility.HIDDEN %} hidden {% endif %}
    {% if file.visibility == FileVisibility.ONCE %} once {% endif %}
    {% if file.blob.type == BlobType.TEXT %} media {% endif %}
    "
    onclick="window.location.href='{{ file.path }}'"
    data-visibility="{{ file.visibility_s }}"
    data-type="{{ file.type_s }}"
    >
    <div class="file-card-header">
        <div>
            <a href="/{{ file.user.username }}">
                <img class="profile-pic" src="/dp/{{ file.user.username }}" title="{{ file.user.username }}">
            </a>
        </div>
        <div class="file-info">
            <b class="file-title">{{ file.title }}</b>
            <span class="file-path">{{ file.path }}</span>
        </div>
        <div class="meta">
            <div>{{ file.views }} Views</div>
            <div>{{ file.comments.count() }} Comments</div>
        </div>
    </div>

    {% if file.password -%}
        {% set custom_body = "<i style='color:blue;'>File is locked</i>" -%}
    {% elif file.visibility == FileVisibility.HIDDEN -%}
        {% set custom_body = "<i style='color:red;'>File is hidden</i>" -%}
    {% elif file.visibility == FileVisibility.ONCE -%}
        {% set custom_body = "<i style='color:gray;'>File can only seen once</i>" -%}
    {% elif file.blob.type != BlobType.TEXT -%}
        {% set custom_body = "<i style='color:purple;'>Media file</i>" -%}
    {% endif -%}

    <div class="file-card-body">
        {% if custom_body == None %}
            {% for line in file.preview().split("\n")[:8] %}
                {{ line }}<br>
            {% endfor %}
        {% else %}
            {{ custom_body | safe }}
        {% endif %}
    </div>
    <div class="action-buttons">
        {% if g.user and file.user == g.user %}
        <a href="{{ SCHEME }}://my.{{ SERVER_NAME }}/files/edit?path={{ file.path }}" title="Edit">
                <button><img src="/static/svg/file-pen-line.svg"></button>
            </a>
        {% endif %}
        <a href="{{ file.path }}" title="View">
            <button><img src="/static/svg/eye.svg"></button>
        </a>
        <a href="/src{{ file.path }}" title="Source">
            <button><img src="/static/svg/code.svg"></button>
        </a>
        <a href="{{ file.path }}#run-button" title="Run">
            <button><img src="/static/svg/play.svg"></button>
        </a>
    </div>
</div>
{% endmacro %}

{# Dir Card #}
{% macro dir_card(dir) %}
<div
    class="dir-card"
    onclick="window.location.href = '{{ dir.path }}'"
    >
    <div class="dir-card-header">
        <div>
            <a href="/{{ dir.username }}">
                <img class="profile-pic" src="/dp/{{ dir.username }}" title="{{ dir.username }}">
            </a>
        </div>
        <div class="dir-info">
            <b class="dir-title">{{ dir.title }}</b>
            <span class="dir-path">{{ dir.path }}</span>
        </div>
        <div class="meta">
            <div>{{ dir.items_count() }} Items</div>
        </div>
    </div>
    <div class="dir-card-body">
        {% for item in dir.items()[:8] %}
        {% if item.__class__.__name__ == "Dir" %}
            <li style="color:orange;">{{ item.title }}</li>
        {% else %}
            <li style="color:black;">{{ item.name }}</li>
        {% endif %}
        {% endfor %}
    </div>
    <div class="action-buttons">
        <a href="{{ dir.path }}" title="Open">
            <button><img src="/static/svg/folder-open.svg"></button>
        </a>
    </div>
</div>
{% endmacro %}

{# Grid Item #}

{# Files Grid View #}
{% macro files_grid_view(items) %}
<div class="files-grid">
    {% for item in items %}
    {% if item.is_file %}
    <div
        class="item"
        onclick="window.location.href = '/files/edit?path={{ item.path }}'"
        data-title="{{ item.name }}"
        data-path="{{ item.path }}"
        data-visibility="{{ item.visibility }}"
        data-type="{{ item.type }}"
        >
        <div class="item-icon">
            <img src="/static/svg/{{ self.type_s }}.svg" alt="Thumbnail" class="item-thumbnail">
        </div>

        <div class="item-details">
            <div class="item-title">{{ item.name or item.path[item.path.rfind("/")+1:] }}</div>
            <div class="item-filename">{{ item.path[item.path.rfind("/")+1:] }}</div>
            <div class="item-size">Size: {{ item.sizef() }}</div>
        </div>

        <div class="item-actions">
            <a href="{{ item.url }}" target="_blank">
                <button title="View"><img src="/static/svg/eye.svg"></button>
            </a>
            
            <a href="/files/delete?path={{ item.path }}">
                <button class="delete" title="Delete"><img src="/static/svg/trash.svg"></button>
            </a>
        </div>
    </div>
    {% else %}
    <div
        class="item"
        onclick="window.location.href = '/files?dir={{ item.dir.path }}'"
        data-title="{{ item.title }}"
        data-path="{{ item.dir }}"
        >
        <div class="item-icon">
            <img src="/static/svg/folder-open.svg">
        </div>

        <div class="item-details">
            <div class="item-title">{{ item.title }}</div>
            <div class="item-filename">{{ item.title }}/</div>
            <div class="item-size">Content: {{ item.items() | length }} items</div>
        </div>

        <div class="item-actions">
            <a href="/files?dir={{ item.dir[item.dir.find("/")+1:] }}" title="Open">
                <button><img src="/static/svg/folder-open.svg"></button>
            </a>
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% endmacro %}

{# Files List View #}
{% macro files_list_view(items) %}
<div class="files-list">
    {% for item in items %}
    {% if item.is_file%}
    <div
        class="item" onclick="window.location.href = '/files/edit?path={{ item.path }}'"
        data-title="{{ item.name }}"
        data-path="{{ item.path }}"
        >
        <img src="/static/svg/filetype/{{ item.type_s }}.svg" alt="Thumbnail" class="item-thumbnail">

        <div class="item-info">
            <h3 class="item-name">{{ item.name or item.path[item.path.rfind("/"):] }}</h3>
            <h5 class="item-path">{{ item.path }}</h5>
            <div class="item-meta">Size: {{ item.sizef() }}</div>
        </div>

        <div class="item-actions">
            <a href="{{ item.url }}" target="_blank" onclick="event.stopPropagation()">
                <button title="View"><img src="/static/svg/eye.svg"></button>
            </a>
            <a href="/files/edit?path={{ item.path }}">
                <button title="Edit"><img src="/static/svg/file-pen-line.svg"></button>
            </a>
            <a href="/files/delete?path={{ item.path }}">
                <button class="delete" title="Delete"><img src="/static/svg/trash.svg"></button>
            </a>
        </div>
    </div>
    {% else %} 
    <div
        class="item"
        onclick="window.location.href = '/files?dir={{ item.path }}'"
        data-title="{{ item.title }}"
        data-path="{{ item.dir }}"
        >
        <img src="/static/svg/folder-open.svg" alt="Thumbnail" class="item-thumbnail">

        <div class="item-info">
            <h3 class="item-name">{{ item.title }}</h3>
            <h5 class="item-path">{{ item.path }}</h5>
            <div class="item-meta">Contains {{ item.items() | length }} Items</div>
        </div>

        <div class="item-actions">
            <a href="/files?dir={{ item.path }}">
                <button><img src="/static/svg/folder-open.svg"></button>
            </a>
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% endmacro %}

{# Pens List View #}
{% macro pens_list_view(pens) %}
<div class="files-list">
    {% for pen in pens %}
    <div
        class="item" onclick="window.location.href = '/pens/edit?id={{ pen.id }}'"
        data-title="{{ pen.title }}"
        data-path="{{ pen.path }}"
        >
        <img src="/static/svg/file-code-corner.svg" alt="Thumbnail" class="item-thumbnail">

        <div class="item-info">
            <h3 class="item-name">{{ pen.title or pen.id }}</h3>
            <h5 class="item-path">{{ pen.path }}</h5>
        </div>

        <div class="item-actions">
            <a href="{{ pen.url }}" target="_blank" onclick="event.stopPropagation()">
                <button title="View"><img src="/static/svg/eye.svg"></button>
            </a>
            <a href="/pens/edit?id={{ pen.id }}">
                <button title="Edit"><img src="/static/svg/file-pen-line.svg"></button>
            </a>
            <a href="/pens/delete?id={{ pen.id }}">
                <button class="delete" title="Delete"><img src="/static/svg/trash.svg"></button>
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% endmacro %}

{# Search Result Card #}
{% macro search_result_card(sr) %}
{% if not sr.item %}
<div class="search-result-card item-not-available">
    <h2>Item no longer available</h2>
</div>
{% else %}
<div
    class="search-result-card item-type-{{ sr.item_type_s }}"
    onclick="window.location.href = '{{ sr.item.path }}'"
>
    <div class="header">
        <div>
            <a href="/{{ sr.item.user.username }}">
                <img class="profile-pic" src="/dp/{{ sr.item.user.username }}" title="{{ sr.item.user.username }}">
            </a>
        </div>
        <div class="item-info">
            <b class="item-title">{{ sr.item.title }}</b>
            <span class="item-path">{{ sr.item.path }}</span>
        </div>
        <div class="meta">
            <div>{{ sr.item.views }} Views</div>
        </div>
    </div>

    <div class="body">
        {% if sr.item_type_s == "file" %}
        {{ sr.item.preview() }}
        {% elif sr.item_type_s == "pen" %}
        {{ "\n".join([sr.item.body_content, sr.item.css_content, sr.item.js_content]) }}
        {% endif %}
    </div>

    <div class="action-buttons">
        <a href="{{ sr.item.path }}" title="View">
            <button><img src="/static/svg/eye.svg"></button>
        </a>
        <a href="/src{{ sr.item.path }}" title="Source">
            <button><img src="/static/svg/code.svg"></button>
        </a>
        <a href="{{ sr.item.path }}#run-button" title="Run">
            <button><img src="/static/svg/play.svg"></button>
        </a>
    </div>
</div>
{% endif %}
{% endmacro %}
