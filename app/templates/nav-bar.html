{# navbar #}

{% macro navbar_links() %}
<a href="{{ SCHEME }}://my.{{ SERVER_NAME }}">Dashboard</a>
<a href="/tmp">Temp Share</a>
<a href="/r">Shortlinks</a>
<a href="/frames">Frames</a>
<a href="/api">API</a>
{% endmacro %}

<nav>
    <div style="display: flex; align-items: center;">
        <a href="/"><h1>HTMLify</h1></a>
    </div>

    <div style="display: flex; align-items: center; overflow: hidden">
        <form class="search-form" action="/search">
            <input type="search" placeholder="Search..." name="q" value="{{ g.q }}">
            <button type="submit" id="search-toggle"><img class="icon" src="/static/svg/search.svg"></button>
        </form>

        <div class="nav-links">
            {{ navbar_links() }}
        </div>
        {% if session.get("user") %}
        <a href="/{{ session["user"]["username"] }}">
            <img class="profile-img" src="/media/dp/{{ session["user"]["username"] }}.jpg" alt="profile">
        </a>
        {% endif %}
        <button type="button" id="mobile-menu-btn"><img class="icon" src="/static/svg/menu.svg"></i></button>
    </div>
</nav>

<!-- Mobile menu -->
<div id="mobile-menu">
    {{ navbar_links() }}
</div>

<script>
const mobile_menu = document.getElementById('mobile-menu');
const mobile_menu_button = document.getElementById('mobile-menu-btn');
const search_form = document.querySelector('.search-form');
const search_toggle = document.getElementById('search-toggle');
const search_input = search_form.querySelector('input');

mobile_menu_button.addEventListener('click', () => {
    if (mobile_menu.style.left === '0px') {
        mobile_menu.style.left = '100%';
        mobile_menu_button.innerHTML = `<img class="icon" src="/static/svg/menu.svg">`;
    } else {
        mobile_menu.style.left = '0px';
        mobile_menu_button.innerHTML = `<img class="icon" src="/static/svg/x.svg">`;
    }
});

search_toggle.addEventListener('click', (e) => {
    if (window.innerWidth <= 768) {
        if (!search_form.classList.contains('expanded')) {
            search_form.classList.add('expanded');
            search_toggle.style.borderRadius = "0 4px 4px 0";
            search_input.focus();
            e.preventDefault();
        }
    }
});

document.addEventListener('mousedown', (e) => {
    if (window.innerWidth <= 768) {
        if (
            search_form.classList.contains('expanded') &&
            !search_form.contains(e.target)
        ) {
            search_form.classList.remove('expanded');
            search_toggle.style.borderRadius = "4px";
        }
    }
});
</script>
